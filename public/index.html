<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trivia Battle</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; min-height: 100vh; color: white; overflow-x: hidden; }
    
    .bg { position: fixed; inset: 0; z-index: -1; background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #0f0c29); background-size: 400% 400%; animation: bg 15s ease infinite; }
    .bg::before { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at 20% 80%, rgba(120,0,255,0.3), transparent 50%), radial-gradient(circle at 80% 20%, rgba(0,212,255,0.3), transparent 50%); }
    @keyframes bg { 0%,100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    
    .container { max-width: 900px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; }
    .logo { text-align: center; margin-bottom: 30px; }
    .logo h1 { font-size: 3rem; font-weight: 800; background: linear-gradient(135deg, #00d4ff, #7c3aed, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: shimmer 3s ease-in-out infinite; }
    .logo p { color: rgba(255,255,255,0.6); font-size: 0.9rem; letter-spacing: 3px; text-transform: uppercase; }
    @keyframes shimmer { 0%,100% { filter: brightness(1); } 50% { filter: brightness(1.2); } }
    
    .screen { display: none; animation: fade 0.3s ease; }
    .screen.active { display: block; }
    @keyframes fade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .card { background: rgba(255,255,255,0.08); backdrop-filter: blur(20px); border-radius: 24px; padding: 30px; border: 1px solid rgba(255,255,255,0.15); margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
    .tabs { display: flex; gap: 5px; margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 5px; border-radius: 12px; }
    .tab { flex: 1; padding: 12px; background: transparent; border: none; color: rgba(255,255,255,0.6); font-size: 0.9rem; font-weight: 600; cursor: pointer; border-radius: 8px; transition: all 0.2s; font-family: inherit; }
    .tab:hover { color: white; }
    .tab.active { background: linear-gradient(135deg, #00d4ff, #7c3aed); color: white; }
    
    .section-title { font-size: 0.85rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; margin-top: 20px; }
    .section-title:first-child { margin-top: 0; }
    
    input { width: 100%; padding: 15px 20px; border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; font-size: 1rem; margin-bottom: 12px; background: rgba(255,255,255,0.05); color: white; font-family: inherit; transition: all 0.2s; }
    input:focus { outline: none; border-color: #00d4ff; background: rgba(0,212,255,0.1); }
    input::placeholder { color: rgba(255,255,255,0.4); }
    
    select { width: 100%; padding: 15px 20px; border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; font-size: 1rem; margin-bottom: 12px; background: rgba(255,255,255,0.05); color: white; font-family: inherit; cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' fill='none' stroke='white' stroke-width='2'%3E%3Cpath d='M6 9l4 4 4-4'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 15px center; }
    select:focus { outline: none; border-color: #7c3aed; }
    select option { background: #1a1a2e; color: white; }
    
    button { width: 100%; padding: 15px; border: none; border-radius: 14px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-bottom: 10px; font-family: inherit; position: relative; overflow: hidden; }
    .btn-primary { background: linear-gradient(135deg, #00d4ff, #7c3aed); color: white; box-shadow: 0 4px 15px rgba(0,212,255,0.3); }
    .btn-primary:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,212,255,0.4); }
    .btn-primary:active:not(:disabled) { transform: translateY(-1px); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-secondary { background: rgba(255,255,255,0.1); color: white; border: 2px solid rgba(255,255,255,0.2); }
    .btn-secondary:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); }
    .btn-success { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; box-shadow: 0 4px 15px rgba(34,197,94,0.3); }
    .btn-success:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(34,197,94,0.4); }
    .btn-warning { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; box-shadow: 0 4px 15px rgba(245,158,11,0.3); }
    .btn-warning:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(245,158,11,0.4); }
    
    .user-bar { display: flex; align-items: center; justify-content: space-between; background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); padding: 18px 22px; border-radius: 18px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
    .user-info { display: flex; align-items: center; gap: 15px; }
    .user-avatar { width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
    .user-details h3 { font-size: 1.15rem; font-weight: 700; }
    .user-details p { font-size: 0.85rem; color: rgba(255,255,255,0.6); }
    .user-stats { display: flex; gap: 25px; }
    .stat { text-align: center; }
    .stat-value { font-size: 1.4rem; font-weight: 700; background: linear-gradient(135deg, #00d4ff, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .stat-label { font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; }
    .xp-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 10px; overflow: hidden; }
    .xp-fill { height: 100%; background: linear-gradient(90deg, #00d4ff, #7c3aed, #f472b6); border-radius: 4px; transition: width 0.5s ease; position: relative; }
    .xp-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%; background: linear-gradient(to bottom, rgba(255,255,255,0.3), transparent); }
    
    .daily-reward { background: linear-gradient(135deg, rgba(251,191,36,0.25), rgba(245,158,11,0.15)); border: 2px solid rgba(251,191,36,0.4); border-radius: 18px; padding: 22px; text-align: center; margin-bottom: 20px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
    .daily-reward::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent); animation: shine 3s infinite; }
    @keyframes shine { 0% { transform: translateX(-100%) rotate(45deg); } 100% { transform: translateX(100%) rotate(45deg); } }
    .daily-reward:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(251,191,36,0.3); }
    .daily-reward.claimed { opacity: 0.5; cursor: not-allowed; }
    .daily-reward.claimed::before { display: none; }
    .daily-reward h3 { color: #fbbf24; margin-bottom: 5px; font-size: 1.1rem; }
    .daily-reward p { font-size: 0.9rem; color: rgba(255,255,255,0.8); }
    
    .avatar-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 6px; margin-bottom: 20px; }
    .avatar-option { aspect-ratio: 1; border-radius: 50%; border: 2px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: all 0.2s; }
    .avatar-option:hover { border-color: rgba(255,255,255,0.3); }
    .avatar-option.selected { border-color: #00d4ff; background: rgba(0,212,255,0.2); }
    .avatar-option.locked { opacity: 0.3; cursor: not-allowed; }
    
    .color-grid { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
    .color-option { width: 40px; height: 40px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; transition: all 0.2s; }
    .color-option:hover { transform: scale(1.1); }
    .color-option.selected { border-color: white; }
    .color-option.locked { opacity: 0.3; cursor: not-allowed; }
    
    .mode-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
    .mode-card { padding: 15px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.2s; }
    .mode-card:hover { background: rgba(255,255,255,0.1); }
    .mode-card.selected { background: rgba(0,212,255,0.2); border-color: #00d4ff; }
    .mode-card .icon { font-size: 1.8rem; margin-bottom: 8px; }
    .mode-card h3 { font-size: 0.9rem; margin-bottom: 3px; }
    .mode-card p { font-size: 0.7rem; color: rgba(255,255,255,0.6); }
    
    .settings-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px; }
    .setting { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; }
    .setting label { display: block; font-size: 0.8rem; color: rgba(255,255,255,0.6); margin-bottom: 8px; }
    .setting input[type="range"] { width: 100%; -webkit-appearance: none; height: 6px; border-radius: 3px; background: rgba(255,255,255,0.1); margin-bottom: 5px; }
    .setting input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: linear-gradient(135deg, #00d4ff, #7c3aed); cursor: pointer; }
    .setting-value { text-align: center; font-weight: 700; color: #00d4ff; }
    .toggle { position: relative; width: 50px; height: 26px; background: rgba(255,255,255,0.1); border-radius: 13px; cursor: pointer; }
    .toggle.active { background: linear-gradient(135deg, #00d4ff, #7c3aed); }
    .toggle::after { content: ''; position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: left 0.2s; }
    .toggle.active::after { left: 27px; }
    
    .room-code { font-size: 3.5rem; font-weight: 800; text-align: center; background: linear-gradient(135deg, #00d4ff, #7c3aed, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 10px; margin: 20px 0; }
    .room-label { font-size: 0.85rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 2px; text-align: center; }
    
    .player-list { list-style: none; display: grid; gap: 8px; }
    .player-list li { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; background: rgba(255,255,255,0.05); border-radius: 12px; }
    .player-list li.answered { background: rgba(34,197,94,0.15); }
    .player-list li .player-info { display: flex; align-items: center; gap: 10px; }
    .player-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
    .player-list li .score { font-weight: 700; color: #00d4ff; }
    .streak-badge { background: linear-gradient(135deg, #fbbf24, #f59e0b); padding: 2px 8px; border-radius: 8px; font-size: 0.7rem; font-weight: 700; margin-left: 8px; }
    
    .game-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .progress { font-size: 0.9rem; color: rgba(255,255,255,0.7); background: rgba(255,255,255,0.1); padding: 6px 14px; border-radius: 20px; }
    .timer { font-size: 2rem; font-weight: 800; color: #00d4ff; min-width: 50px; text-align: center; }
    .timer.warning { color: #f472b6; animation: pulse 0.5s infinite; }
    @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    
    .timer-bar { width: 100%; height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-bottom: 15px; overflow: hidden; }
    .timer-fill { height: 100%; background: linear-gradient(90deg, #00d4ff, #7c3aed); transition: width 1s linear; }
    .timer-fill.warning { background: linear-gradient(90deg, #f472b6, #ef4444); }
    
    .question { font-size: 1.4rem; text-align: center; margin-bottom: 15px; font-weight: 600; line-height: 1.3; }
    .difficulty { display: inline-block; padding: 3px 10px; border-radius: 10px; font-size: 0.75rem; font-weight: 600; margin-left: 8px; }
    .difficulty.easy { background: rgba(34,197,94,0.3); color: #22c55e; }
    .difficulty.medium { background: rgba(251,191,36,0.3); color: #fbbf24; }
    .difficulty.hard { background: rgba(239,68,68,0.3); color: #ef4444; }
    
    .powers-bar { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-bottom: 15px; }
    .power-btn { display: flex; flex-direction: column; align-items: center; padding: 8px 12px; background: linear-gradient(135deg, rgba(251,191,36,0.2), rgba(245,158,11,0.1)); border: 2px solid rgba(251,191,36,0.3); border-radius: 10px; cursor: pointer; min-width: 65px; }
    .power-btn:hover { background: linear-gradient(135deg, rgba(251,191,36,0.3), rgba(245,158,11,0.2)); }
    .power-btn .icon { font-size: 1.2rem; }
    .power-btn .name { font-size: 0.65rem; font-weight: 600; }
    
    .options { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 15px; }
    .option { padding: 22px; background: rgba(255,255,255,0.06); border: 2px solid rgba(255,255,255,0.12); border-radius: 18px; color: white; font-size: 1rem; font-weight: 600; cursor: pointer; font-family: inherit; position: relative; transition: all 0.25s; text-align: left; }
    .option:hover:not(:disabled) { background: rgba(0,212,255,0.12); border-color: #00d4ff; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,212,255,0.2); }
    .option.selected { background: rgba(0,212,255,0.2); border-color: #00d4ff; box-shadow: 0 0 20px rgba(0,212,255,0.3); }
    .option.correct { background: rgba(34,197,94,0.3); border-color: #22c55e; box-shadow: 0 0 25px rgba(34,197,94,0.4); }
    .option.wrong { background: rgba(239,68,68,0.3); border-color: #ef4444; box-shadow: 0 0 25px rgba(239,68,68,0.4); }
    .option:disabled { cursor: not-allowed; transform: none; }
    .option.eliminated { opacity: 0.25; text-decoration: line-through; transform: scale(0.98); }
    .option-label { position: absolute; top: 10px; left: 14px; font-size: 0.75rem; color: rgba(255,255,255,0.5); font-weight: 700; background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 6px; }
    
    .results-list { display: grid; gap: 10px; margin-bottom: 20px; }
    .result { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-radius: 10px; }
    .result.correct { background: rgba(34,197,94,0.2); border-left: 4px solid #22c55e; }
    .result.wrong { background: rgba(239,68,68,0.2); border-left: 4px solid #ef4444; }
    .result .mascot { font-size: 1.3rem; margin-right: 10px; }
    .result .name { font-weight: 600; }
    .result .pts { font-weight: 700; }
    .result.correct .pts { color: #22c55e; }
    .result.wrong .pts { color: #ef4444; }
    
    .scoreboard { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; }
    .scoreboard h3 { text-align: center; margin-bottom: 12px; color: rgba(255,255,255,0.7); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
    .score-row { display: flex; justify-content: space-between; padding: 10px 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 6px; }
    .score-row .mascot { font-size: 1.1rem; margin-right: 8px; }
    .score-row .pts { font-weight: 700; color: #00d4ff; }
    
    .rankings { display: flex; flex-direction: column; gap: 10px; }
    .rank { display: flex; align-items: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; }
    .rank.winner { background: linear-gradient(135deg, rgba(251,191,36,0.2), rgba(245,158,11,0.1)); border: 2px solid rgba(251,191,36,0.5); }
    .rank-num { font-size: 1.5rem; font-weight: 800; width: 50px; color: rgba(255,255,255,0.5); }
    .rank-mascot { font-size: 1.8rem; margin-right: 12px; }
    .rank-name { flex: 1; font-size: 1.1rem; font-weight: 600; }
    .rank-score { font-size: 1.2rem; font-weight: 700; color: #00d4ff; }
    .crown { font-size: 1.8rem; margin-right: 8px; }
    
    .rewards { background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(245,158,11,0.1)); border-radius: 12px; padding: 15px; margin-bottom: 15px; text-align: center; }
    .rewards h3 { color: #fbbf24; margin-bottom: 10px; }
    .rewards-grid { display: flex; gap: 30px; justify-content: center; }
    .rewards-grid .val { font-size: 1.5rem; font-weight: 800; }
    .rewards-grid .xp { color: #00d4ff; }
    .rewards-grid .coins { color: #fbbf24; }
    .rewards-grid .lbl { font-size: 0.8rem; color: rgba(255,255,255,0.6); }
    
    .leaderboard-list { display: grid; gap: 8px; }
    .lb-item { display: flex; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 10px; }
    .lb-rank { width: 35px; font-weight: 800; }
    .lb-rank.gold { color: #fbbf24; }
    .lb-rank.silver { color: #94a3b8; }
    .lb-rank.bronze { color: #cd7f32; }
    .lb-avatar { width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem; margin-right: 12px; }
    .lb-name { flex: 1; font-weight: 600; }
    .lb-val { font-weight: 700; color: #00d4ff; }
    
    .achievements { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; }
    .achieve { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; text-align: center; opacity: 0.4; }
    .achieve.unlocked { opacity: 1; background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(245,158,11,0.1)); border: 1px solid rgba(251,191,36,0.3); }
    .achieve .icon { font-size: 1.8rem; margin-bottom: 8px; }
    .achieve h4 { font-size: 0.85rem; margin-bottom: 4px; }
    .achieve p { font-size: 0.7rem; color: rgba(255,255,255,0.5); }
    
    .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); background: rgba(239,68,68,0.95); padding: 12px 25px; border-radius: 10px; font-weight: 600; z-index: 1000; transition: transform 0.3s; }
    .toast.show { transform: translateX(-50%) translateY(0); }
    .toast.success { background: rgba(34,197,94,0.95); }
    .toast.info { background: rgba(251,191,36,0.95); }
    
    .popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9); background: rgba(0,0,0,0.95); padding: 25px 40px; border-radius: 16px; text-align: center; z-index: 2000; border: 2px solid rgba(251,191,36,0.5); opacity: 0; pointer-events: none; transition: all 0.2s; }
    .popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; }
    .popup .icon { font-size: 2.5rem; margin-bottom: 10px; }
    .popup h3 { font-size: 1.3rem; color: #fbbf24; margin-bottom: 8px; }
    .popup p { color: rgba(255,255,255,0.7); }
    
    .confetti { position: fixed; width: 8px; height: 8px; top: -10px; animation: conf 3s linear forwards; }
    @keyframes conf { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    
    .btn-loading { position: relative; color: transparent !important; pointer-events: none; }
    .btn-loading::after { content: ''; position: absolute; width: 20px; height: 20px; top: 50%; left: 50%; margin: -10px 0 0 -10px; border: 3px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .floating { animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    
    .glow { animation: glow 2s ease-in-out infinite alternate; }
    @keyframes glow { from { box-shadow: 0 0 10px rgba(0,212,255,0.3); } to { box-shadow: 0 0 30px rgba(0,212,255,0.6), 0 0 60px rgba(124,58,237,0.3); } }
    
    .pulse { animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    
    .slide-up { animation: slideUp 0.5s ease-out; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    
    .shake { animation: shake 0.5s ease-in-out; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-5px); } 40%, 80% { transform: translateX(5px); } }
    
    .bounce-in { animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
    @keyframes bounceIn { from { opacity: 0; transform: scale(0.3); } to { opacity: 1; transform: scale(1); } }
    
    .gradient-text { background: linear-gradient(135deg, #00d4ff, #7c3aed, #f472b6, #fbbf24); background-size: 300% 300%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: gradientShift 4s ease infinite; }
    @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    
    .rainbow-border { background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #8b00ff, #ff0000); background-size: 400% 100%; animation: rainbowMove 3s linear infinite; }
    @keyframes rainbowMove { to { background-position: 400% 0; } }
    
    #particles { position: fixed; inset: 0; pointer-events: none; z-index: -1; overflow: hidden; }
    .particle { position: absolute; width: 4px; height: 4px; background: rgba(0,212,255,0.5); border-radius: 50%; animation: particleFloat 15s linear infinite; }
    @keyframes particleFloat { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; } }
    
    
    @media (max-width: 600px) {
      .logo h1 { font-size: 2rem; }
      .room-code { font-size: 2rem; letter-spacing: 5px; }
      .options { grid-template-columns: 1fr; gap: 10px; }
      .mode-grid { grid-template-columns: 1fr 1fr; }
      .avatar-grid { grid-template-columns: repeat(6, 1fr); gap: 4px; }
      .color-grid { flex-wrap: wrap; }
      .user-bar { flex-direction: column; gap: 10px; text-align: center; }
      .user-stats { width: 100%; justify-content: space-around; }
      .card { padding: 15px; margin: 10px; }
      .tabs { flex-wrap: wrap; }
      .tab { font-size: 0.8rem; padding: 8px 12px; }
      button { font-size: 0.95rem; }
      .game-header { flex-direction: column; gap: 5px; }
      .timer { font-size: 1.5rem; }
      .question { font-size: 1.1rem; }
      .powers-bar { flex-wrap: wrap; }
      .power-btn { min-width: 50px; padding: 5px; }
      .settings-grid { grid-template-columns: 1fr; }
      .achievements { grid-template-columns: repeat(2, 1fr); }
      .achievements .achieve { padding: 10px; }
      .achievements .icon { font-size: 1.5rem; }
      .rewards-grid { gap: 15px; }
      .rankings { gap: 8px; }
      .rank { padding: 10px; }
      .confetti { width: 6px; height: 6px; }
      .profile-tab { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 400px) {
      .tabs { gap: 2px; }
      .tab { padding: 6px 8px; font-size: 0.75rem; }
    }
@media (max-width: 600px) {
      .logo h1 { font-size: 2.2rem; }
      .room-code { font-size: 2.5rem; }
      .options { grid-template-columns: 1fr; }
      .mode-grid { grid-template-columns: 1fr 1fr; }
      .avatar-grid { grid-template-columns: repeat(7, 1fr); }
    }
  </style>
</head>
<body>
  <div class="bg"></div>
  <div id="particles"></div>
    <div id="keyboard-hint" style="position:fixed;bottom:10px;right:10px;background:rgba(255,255,255,0.1);padding:5px 10px;border-radius:8px;font-size:0.75rem;color:rgba(255,255,255,0.5);z-index:100">Press 1-4 to answer | Space to submit</div>
  <div class="container">
    <div class="logo"><h1 class="gradient-text">Trivia Battle</h1><p>Ultimate Multiplayer Quiz</p></div>
    
    <div id="auth-screen" class="screen active">
      <div class="card glow">
        <div class="tabs">
          <button class="tab active" onclick="showAuthTab('login')">Login</button>
          <button class="tab" onclick="showAuthTab('register')">Register</button>
        </div>
        <div id="login-form">
          <input type="text" id="login-username" placeholder="Username" maxlength="15" autocomplete="off">
          <input type="password" id="login-password" placeholder="Password" autocomplete="off">
          <button class="btn-primary" id="login-btn" onclick="login()">Login</button>
        </div>
        <div id="register-form" style="display:none">
          <input type="text" id="reg-username" placeholder="Username (2-15 chars)" maxlength="15" autocomplete="off">
          <input type="password" id="reg-password" placeholder="Password (min 4 chars)" autocomplete="off">
          <button class="btn-primary" id="register-btn" onclick="register()">Create Account</button>
        </div>
      </div>
    </div>

    <div id="main-screen" class="screen">
      <div class="user-bar">
        <div class="user-info">
          <div class="user-avatar" id="user-avatar">ü¶ä</div>
          <div class="user-details">
            <h3 id="user-name">Player</h3>
            <p>Lv.<span id="user-level">1</span> ‚Ä¢ <span id="user-coins">0</span> ü™ô</p>
            <div class="xp-bar"><div class="xp-fill" id="xp-fill"></div></div>
          </div>
        </div>
        <div class="user-stats">
          <div class="stat"><div class="stat-value" id="user-wins">0</div><div class="stat-label">Wins</div></div>
          <div class="stat"><div class="stat-value" id="user-streak">0</div><div class="stat-label">Best</div></div>
        </div>
        <button id="sound-toggle" onclick="toggleSound()" style="width:auto;padding:10px 12px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:white;font-size:1rem;margin:0 5px">üîä</button><button onclick="location.reload()" style="width:auto;padding:10px 16px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:white;font-size:0.85rem;margin:0">Logout</button>
      </div>

      <div id="streak-display" style="background:rgba(124,58,237,0.1);border:2px solid rgba(124,58,237,0.4);border-radius:18px;padding:15px;margin-bottom:15px;text-align:center"><h3 style="color:#7c3aed">üî• Login Streak</h3><p style="font-size:2rem;font-weight:800;color:#7c3aed"><span id="streak-count">0</span> days</p><p style="font-size:0.85rem;color:rgba(255,255,255,0.6)">Come back daily for bonus coins!</p></div>
      <div class="daily-reward floating" id="daily-reward" onclick="claimDaily()">
        <h3>üéÅ Daily Reward</h3>
        <p>Click to claim XP & coins!</p>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="showMainTab('play')">Play</button>
        <button class="tab" onclick="showMainTab('customize')">Customize</button>
        <button class="tab" onclick="showMainTab('achievements')">Achievements</button>
        <button class="tab" onclick="showMainTab('leaderboard')">Ranks</button>
        <button class="tab" onclick="showMainTab('challenges')">Challenges</button>
        <button class="tab" onclick="showMainTab('friends')">Friends</button>
        <button class="tab" onclick="showMainTab('shop')">Shop</button>
        <button class="tab" onclick="showMainTab('profile')">Profile</button>
        <button class="tab" onclick="showMainTab('sandbox')">Sandbox</button>
      </div>

      <div id="play-tab" class="tab-content">
        <div class="card slide-up">
          <button class="btn-primary glow" onclick="showCreateScreen()">üéÆ Create Room</button>
          
          <button class="btn-secondary" onclick="showJoinScreen()">üö™ Join Room</button>
          <button class="btn-warning" onclick="startPractice()">ü§ñ Practice (vs Bot)</button>
          
        </div>
      </div>

      <div id="customize-tab" class="tab-content" style="display:none">
        <div class="card">
          <p class="section-title">Your Avatar</p>
          <div class="avatar-grid" id="avatar-grid"></div>
          <p class="section-title">Your Color</p>
          <div class="color-grid" id="color-grid"></div>
          <button class="btn-primary" onclick="saveCustomize()">Save</button>
        </div>
      </div>

      <div id="achievements-tab" class="tab-content" style="display:none">
        <div class="card">
          <p class="section-title">Achievements</p>
          <div class="achievements" id="achievements-grid"></div>
        </div>
      </div>

      <div id="leaderboard-tab" class="tab-content" style="display:none">
        <div class="card">
          <p class="section-title">Leaderboard</p>
          <div class="tabs" style="margin-bottom:15px">
            <button class="tab active" onclick="loadLB('xp', this)">XP</button>
            <button class="tab" onclick="loadLB('wins', this)">Wins</button>
            <button class="tab" onclick="loadLB('streak', this)">Streak</button>
          </div>
          <div class="leaderboard-list" id="lb-list"></div>
        </div>
      </div>

      


<div id="challenges-tab" class="tab-content" style="display:none">
  <div class="card">
    <p class="section-title">üéØ Daily Challenges</p>
    <p style="margin-bottom:15px;color:rgba(255,255,255,0.6)">Complete challenges for bonus rewards!</p>
    <div id="challenges-list"></div>
  </div>
</div>
<div id="friends-tab" class="tab-content" style="display:none">
  <div class="card">
    <p class="section-title">üë• Friends</p>
    <input type="text" id="friend-search" placeholder="Search username..." style="margin-bottom:10px">
    <button class="btn-primary" onclick="searchFriend()" style="margin-bottom:15px">Search</button>
    <div id="friend-search-results" style="margin-bottom:20px"></div>
    
    <p class="section-title">Friend Requests</p>
    <div id="friend-requests" style="margin-bottom:20px"></div>
    
    <p class="section-title">Your Friends</p>
    <div id="friends-list"></div>
  </div>
</div>
<div id="shop-tab" class="tab-content" style="display:none">
  <div class="card">
    <p class="section-title">üè™ Power-ups Shop</p>
    <p style="margin-bottom:15px;color:rgba(255,255,255,0.6)">Buy power-ups to use in games! You currently have <span id="shop-coins" style="color:#fbbf24;font-weight:700">0</span> coins.</p>
    <div id="shop-items" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px"></div>
  </div>
</div>
<div id="profile-tab" class="tab-content" style="display:none">
        <div class="card">
          <div style="display:flex;align-items:center;gap:20px;margin-bottom:20px">
            <div class="user-avatar" id="profile-avatar" style="width:80px;height:80px;font-size:2.5rem">ü¶ä</div>
            <div>
              <h2 id="profile-username" style="margin-bottom:5px">Player</h2>
              <p style="color:rgba(255,255,255,0.6)">Level <span id="profile-level">1</span> ‚Ä¢ <span id="profile-xp">0</span> XP</p>
            </div>
          </div>
          
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px">
            <div style="background:rgba(0,212,255,0.1);padding:15px;border-radius:10px;text-align:center">
              <div style="font-size:1.5rem;font-weight:700;color:#00d4ff" id="profile-games">0</div>
              <div style="font-size:0.75rem;color:rgba(255,255,255,0.6)">Games</div>
            </div>
            <div style="background:rgba(34,197,94,0.1);padding:15px;border-radius:10px;text-align:center">
              <div style="font-size:1.5rem;font-weight:700;color:#22c55e" id="profile-wins">0</div>
              <div style="font-size:0.75rem;color:rgba(255,255,255,0.6)">Wins</div>
            </div>
            <div style="background:rgba(251,191,36,0.1);padding:15px;border-radius:10px;text-align:center">
              <div style="font-size:1.5rem;font-weight:700;color:#fbbf24" id="profile-streak">0</div>
              <div style="font-size:0.75rem;color:rgba(255,255,255,0.6)">Best Streak</div>
            </div>
            <div style="background:rgba(124,58,237,0.1);padding:15px;border-radius:10px;text-align:center">
              <div style="font-size:1.5rem;font-weight:700;color:#7c3aed" id="profile-accuracy">0%</div>
              <div style="font-size:0.75rem;color:rgba(255,255,255,0.6)">Accuracy</div>
            </div>
          </div>
          
          <p class="section-title">Recent Games</p>
          <div id="profile-history" style="max-height:300px;overflow-y:auto"></div>
        </div>
      </div>

      <div id="sandbox-tab" class="tab-content" style="display:none">
        <div class="card">
          <p class="section-title">üß™ Sandbox Testing Area</p>
          
          <div style="background:rgba(0,212,255,0.1);padding:15px;border-radius:10px;margin-bottom:15px">
            <h3 style="color:#00d4ff;margin-bottom:10px">Points Calculator</h3>
            <div class="settings-grid">
              <div class="setting">
                <label>Base Points</label>
                <input type="number" id="test-base" value="100" style="width:100%">
              </div>
              <div class="setting">
                <label>Time Left (sec)</label>
                <input type="number" id="test-time" value="5" style="width:100%">
              </div>
              <div class="setting">
                <label>Streak</label>
                <input type="number" id="test-streak" value="3" style="width:100%">
              </div>
              <div class="setting">
                <label>Difficulty</label>
                <select id="test-diff"><option value="1">Easy (1x)</option><option value="1.5" selected>Medium (1.5x)</option><option value="2">Hard (2x)</option><option value="1.25">Mixed (1.25x)</option></select>
              </div>
            </div>
            <button class="btn-primary" onclick="calcPoints()">Calculate Points</button>
            <div id="points-result" style="margin-top:10px;padding:10px;background:rgba(34,197,94,0.2);border-radius:8px;display:none"></div>
          </div>

          <div style="background:rgba(251,191,36,0.1);padding:15px;border-radius:10px;margin-bottom:15px">
            <h3 style="color:#fbbf24;margin-bottom:10px">XP & Level Calculator</h3>
            <div class="settings-grid">
              <div class="setting">
                <label>Current XP</label>
                <input type="number" id="test-xp" value="0" style="width:100%">
              </div>
              <div class="setting">
                <label>XP to Add</label>
                <input type="number" id="test-xp-add" value="150" style="width:100%">
              </div>
            </div>
            <button class="btn-primary" onclick="calcXP()">Calculate Level</button>
            <div id="xp-result" style="margin-top:10px;padding:10px;background:rgba(251,191,36,0.2);border-radius:8px;display:none"></div>
          </div>

          <div style="background:rgba(124,58,237,0.1);padding:15px;border-radius:10px;margin-bottom:15px">
            <h3 style="color:#7c3aed;margin-bottom:10px">Simulate Game End</h3>
            <div class="settings-grid">
              <div class="setting">
                <label>Your Score</label>
                <input type="number" id="sim-score" value="500" style="width:100%">
              </div>
              <div class="setting">
                <label>Your Rank</label>
                <select id="sim-rank"><option value="0">1st ü•á</option><option value="1">2nd ü•à</option><option value="2">3rd ü•â</option><option value="3">4th+</option></select>
              </div>
            </div>
            <button class="btn-warning" onclick="simGame()">Simulate Rewards</button>
            <div id="sim-result" style="margin-top:10px;padding:10px;background:rgba(124,58,237,0.2);border-radius:8px;display:none"></div>
          </div>

          <div style="background:rgba(239,68,68,0.1);padding:15px;border-radius:10px;margin-bottom:15px">
            <h3 style="color:#ef4444;margin-bottom:10px">Superpowers Reference</h3>
            <div id="powers-ref" style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px"></div>
          </div>

          <div style="background:rgba(34,197,94,0.1);padding:15px;border-radius:10px;margin-bottom:15px">
            <h3 style="color:#22c55e;margin-bottom:10px">Avatar & Color Unlocks</h3>
            <div id="unlocks-ref"></div>
          </div>

          <button class="btn-secondary" onclick="resetSandbox()">Reset Test Data</button>
        </div>
      </div>
    </div>

    <div id="create-screen" class="screen">
      <div class="card">
        <p class="section-title">Select Theme</p>
        <select id="theme-select">
          <option value="Random">Random</option>
          <option value="Science">Science</option>
          <option value="Geography">Geography</option>
          <option value="History">History</option>
          <option value="Space">Space</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Sports">Sports</option>
          <option value="Food">Food</option>
          <option value="Technology">Technology</option>
        </select>

        <p class="section-title">Game Mode</p>
        <div class="mode-grid" id="mode-grid"></div>

        <p class="section-title">Settings</p>
        <div class="settings-grid">
          <div class="setting">
            <label>Questions</label>
            <input type="range" id="q-count" min="5" max="25" value="15">
            <div class="setting-value" id="q-count-val">15</div>
          </div>
          <div class="setting">
            <label>Time (sec)</label>
            <input type="range" id="time-limit" min="3" max="20" value="10">
            <div class="setting-value" id="time-val">10</div>
          </div>
          <div class="setting">
            <label>Difficulty</label>
            <select id="diff-select"><option value="mixed">Mixed</option><option value="easy">Easy</option><option value="medium">Medium</option><option value="hard">Hard</option></select>
          </div>
          <div class="setting">
            <label>Power-ups</label>
            <div class="toggle active" id="pwr-toggle" onclick="togglePwr()"></div>
          </div>
        </div>

        <button class="btn-primary" onclick="createRoom()">Create Room</button>
        <button class="btn-secondary" onclick="showMainScreen()">Back</button>
      </div>
    </div>

    <div id="join-screen" class="screen">
      <div class="card">
        <input type="text" id="join-code" placeholder="Room Code" maxlength="4" style="text-transform:uppercase;letter-spacing:8px;text-align:center;font-size:1.8rem">
        <button class="btn-primary" onclick="joinRoom()">Join</button>
        <button class="btn-secondary" onclick="showMainScreen()">Back</button>
      </div>
    </div>

    <div id="lobby-screen" class="screen">
      <div class="card">
        <p class="room-label">Room Code</p>
        <div class="room-code" id="room-code"></div>
        <div style="text-align:center;margin-bottom:15px">
          <span class="difficulty easy" id="lobby-theme">Theme</span>
          <span class="difficulty medium" id="lobby-mode">Mode</span>
        </div>
        <div style="text-align:center;margin-bottom:15px">
          <span class="difficulty hard" id="lobby-settings">Settings</span>
        </div>
        <ul class="player-list" id="player-list"></ul>
        <button class="btn-primary" id="start-btn" onclick="startGame()" disabled>Start</button>
      </div>
    </div>

    <div id="waiting-screen" class="screen">
      <div class="card" style="text-align:center">
        <div style="width:40px;height:40px;margin:0 auto 15px;border:3px solid rgba(255,255,255,0.1);border-top-color:#00d4ff;border-radius:50%;animation:spin 1s linear infinite"></div>
        <h2>Waiting for host...</h2>
        <p style="color:rgba(255,255,255,0.6);margin-top:8px">Share the code below!</p>
        <p class="room-label" style="margin-top:20px">Room Code</p>
        <div class="room-code" id="wait-code"></div>
        <ul class="player-list" id="wait-list" style="margin-top:20px"></ul>
      </div>
    </div>

    <div id="game-screen" class="screen">
      <div class="card">
        <div class="game-header">
          <div><span class="progress" id="progress">Q 1/15</span><span class="difficulty easy" id="diff-badge"></span></div>
          <div class="timer" id="timer">10</div>
        </div>
        <div class="timer-bar"><div class="timer-fill" id="timer-fill"></div></div>
        <div class="powers-bar" id="powers-bar"></div>
        <div class="question" id="question"></div>
        <div class="options" id="options"></div>
        <button class="btn-success" id="submit-btn" onclick="submitAnswer()" disabled>Submit</button>
      </div>
    </div>

    <div id="results-screen" class="screen">
      <div class="card">
        <h2 style="text-align:center;margin-bottom:20px;background:linear-gradient(90deg,#00d4ff,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent">Results</h2>
        <div class="results-list" id="results-list"></div>
        <div class="scoreboard"><h3>Scores</h3><div id="scores"></div></div>
        <div id="skip-section" style="text-align:center;margin-top:15px"></div>
      </div>
    </div>

    <div id="gameover-screen" class="screen">
      <div class="card">
        <h2 style="text-align:center;font-size:2.5rem;background:linear-gradient(135deg,#f472b6,#fb923c,#fbbf24);-webkit-background-clip:text;-webkit-text-fill-color:transparent">Game Over!</h2>
        <div class="rewards" id="rewards-box">
          <h3>Rewards</h3>
          <div class="rewards-grid">
            <div><div class="val xp" id="xp-earned">+0</div><div class="lbl">XP</div></div>
            <div><div class="val coins" id="coins-earned">+0</div><div class="lbl">Coins</div></div>
          </div>
        </div>
        <div class="rankings" id="rankings"></div>
        <div style="display:flex;gap:10px;margin-top:15px">
          <button class="btn-warning" onclick="rematch()">Rematch</button>
          <button class="btn-primary" onclick="location.reload()">Home</button>
        </div>
      </div>
    </div>
  </div>

  
<div id="tutorial-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:9999;overflow-y:auto">
  <div style="max-width:500px;margin:20px auto;padding:20px">
    <h1 style="text-align:center;margin-bottom:30px;background:linear-gradient(135deg,#00d4ff,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent">Welcome to Trivia Battle!</h1>
    
    <div style="background:rgba(0,212,255,0.1);padding:20px;border-radius:12px;margin-bottom:15px">
      <h3 style="color:#00d4ff;margin-bottom:10px">üéØ How to Play</h3>
      <p style="line-height:1.6">Answer trivia questions faster than your opponents! The faster you answer correctly, the more points you earn.</p>
    </div>
    
    <div style="background:rgba(124,58,237,0.1);padding:20px;border-radius:12px;margin-bottom:15px">
      <h3 style="color:#7c3aed;margin-bottom:10px">üéÆ Game Modes</h3>
      <ul style="line-height:1.8;padding-left:20px">
        <li><strong>Classic</strong> - Standard trivia, 15 questions</li>
        <li><strong>Speed</strong> - Faster timer, higher stakes!</li>
        <li><strong>Survival</strong> - 3 lives, one wrong = lose a life</li>
        <li><strong>Betting</strong> - Bet points before answering</li>
        <li><strong>Lightning</strong> - 3 second rapid-fire!</li>
      </ul>
    </div>
    
    <div style="background:rgba(251,191,36,0.1);padding:20px;border-radius:12px;margin-bottom:15px">
      <h3 style="color:#fbbf24;margin-bottom:10px">‚ö° Superpowers</h3>
      <p style="line-height:1.6">Answer correctly and you might earn a superpower! Use them strategically:</p>
      <ul style="line-height:1.8;padding-left:20px">
        <li><strong>50/50</strong> - Removes 2 wrong answers</li>
        <li><strong>Shield</strong> - Protected from wrong answer</li>
        <li><strong>Double Points</strong> - 2x points this round</li>
        <li><strong>Steal</strong> - Take 50 points from opponent</li>
      </ul>
    </div>
    
    <div style="background:rgba(34,197,94,0.1);padding:20px;border-radius:12px;margin-bottom:15px">
      <h3 style="color:#22c55e;margin-bottom:10px">üí∞ Rewards</h3>
      <p style="line-height:1.6">Earn <strong>XP</strong> to level up and unlock avatars/colors. Earn <strong>coins</strong> to buy items in the shop. Claim your <strong>daily reward</strong> every day!</p>
    </div>
    
    <div style="background:rgba(239,68,68,0.1);padding:20px;border-radius:12px;margin-bottom:15px">
      <h3 style="color:#ef4444;margin-bottom:10px">ü§ñ Practice Mode</h3>
      <p style="line-height:1.6">New to the game? Try <strong>Practice Mode</strong> to play against AI bots without affecting your stats!</p>
    </div>
    
    <button class="btn-primary" onclick="closeTutorial()" style="margin-top:20px">Got it, let's play!</button>
  </div>
</div>
<div class="toast" id="toast"></div>
  <div class="popup" id="popup"><div class="icon"></div><h3></h3><p></p></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const COLORS = ['linear-gradient(135deg,#00d4ff,#0099cc)','linear-gradient(135deg,#7c3aed,#5b21b6)','linear-gradient(135deg,#f472b6,#db2777)','linear-gradient(135deg,#22c55e,#16a34a)','linear-gradient(135deg,#f59e0b,#d97706)','linear-gradient(135deg,#ef4444,#dc2626)','linear-gradient(135deg,#06b6d4,#0891b2)','linear-gradient(135deg,#8b5cf6,#7c3aed)','linear-gradient(135deg,#ec4899,#db2777)','linear-gradient(135deg,#14b8a6,#0d9488)'];
    const socket = io();
    // Sound Effects System
    let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
    let audioCtx = null;
    function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function playSound(name) { if (!soundEnabled) return; try { initAudio(); const s = SOUNDS[name]; if (!s) return; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = s.type; osc.frequency.value = s.freq; gain.gain.setValueAtTime(0.3, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + s.duration); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + s.duration); } catch(e) {} }
    function toggleSound() { soundEnabled = !soundEnabled; localStorage.setItem('soundEnabled', soundEnabled); document.getElementById('sound-toggle').textContent = soundEnabled ? 'üîä' : 'üîá'; if (soundEnabled) playSound('click'); }


    let user = null, isHost = false, room = '', timer, selected = null, confirmed = false, frozen = false, powers = [], pwrEnabled = true, mode = 'Classic', isPractice = false;
    
    function showScreen(id) { document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function toast(msg, type='error') { const t=document.getElementById('toast'); t.textContent=msg; t.className='toast show '+(type||''); t.classList.add('bounce-in'); setTimeout(()=>t.classList.remove('bounce-in'),600); setTimeout(()=>t.classList.remove('show'),2500); }
    function popup(icon,title,msg) { const p=document.getElementById('popup'); p.querySelector('.icon').textContent=icon; p.querySelector('h3').textContent=title; p.querySelector('p').textContent=msg; p.classList.add('show','bounce-in'); setTimeout(()=>p.classList.remove('show','bounce-in'),2000); }
    function confetti() { const c=['#00d4ff','#7c3aed','#f472b6','#22c55e','#fbbf24','#ef4444','#ff7f00','#8b5cf6']; for(let i=0;i<60;i++){ setTimeout(()=>{ const e=document.createElement('div'); e.className='confetti'; e.style.left=Math.random()*100+'%'; e.style.background=c[Math.floor(Math.random()*c.length)]; e.style.borderRadius=Math.random()>.5?'50%':'0'; e.style.width=(4+Math.random()*6)+'px'; e.style.height=e.style.width; e.style.animationDuration=(2+Math.random()*2)+'s'; document.body.appendChild(e); setTimeout(()=>e.remove(),4000); },i*30); } }

    function showAuthTab(t) { document.querySelectorAll('#auth-screen .tab').forEach(x=>x.classList.remove('active')); event.currentTarget.classList.add('active'); document.getElementById('login-form').style.display=t==='login'?'block':'none'; document.getElementById('register-form').style.display=t==='register'?'block':'none'; }
    function showMainTab(t) { document.querySelectorAll('#main-screen .tab').forEach(x=>x.classList.remove('active')); event.currentTarget.classList.add('active'); document.querySelectorAll('.tab-content').forEach(x=>x.style.display='none'); document.getElementById(t+'-tab').style.display='block'; if(t==='leaderboard')loadLB('xp',document.querySelector('#leaderboard-tab .tab')); if(t==='achievements')loadAch(); if(t==='customize')loadInv(); if(t==='shop')loadShop(); if(t==='friends')loadFriends(); if(t==='challenges')loadChallenges(); if(t==='profile')loadProfile(); }
    function showCreateScreen() { initModes(); showScreen('create-screen'); }
    function showJoinScreen() { showScreen('join-screen'); }
    function showMainScreen() { showScreen('main-screen'); }
    function closeTutorial() { document.getElementById("tutorial-overlay").style.display = "none"; }
    function showTutorial() { document.getElementById("tutorial-overlay").style.display = "block"; }
    document.addEventListener('keydown', e => {
  if (document.getElementById('game-screen').classList.contains('active')) {
    if (e.key >= '1' && e.key <= '4') { sel(parseInt(e.key) - 1); }
    if (e.key === ' ') { e.preventDefault(); submitAnswer(); }
  }
});
function startPractice() { isPractice = true; showCreateScreen(); toast('Practice Mode - No XP/Stats counted','info'); }

    async function login() {
      const btn = document.getElementById('login-btn');
      const u=document.getElementById('login-username').value.trim(), p=document.getElementById('login-password').value;
      if(!u||!p) return toast('Enter username and password');
      btn.classList.add('btn-loading');
      btn.disabled = true;
      try {
        const r=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
        const d=await r.json();
        if(d.error) { btn.classList.remove('btn-loading'); btn.disabled = false; return toast(d.error); }
        localStorage.setItem('tutorialSeen', 'true'); user=d.user; socket.emit('set-user',user); updateUI(); showScreen('main-screen'); checkDaily(); playSound('levelup');
      } catch(e) { btn.classList.remove('btn-loading'); btn.disabled = false; toast('Connection error'); }
    }

    async function register() {
      const btn = document.getElementById('register-btn');
      const u=document.getElementById('reg-username').value.trim(), p=document.getElementById('reg-password').value;
      if(!u||u.length<2) return toast('Username: 2-15 chars');
      if(!p||p.length<4) return toast('Password: min 4 chars');
      btn.classList.add('btn-loading');
      btn.disabled = true;
      try {
        const r=await fetch('/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
        const d=await r.json();
        if(d.error) { btn.classList.remove('btn-loading'); btn.disabled = false; return toast(d.error); }
        user=d.user; socket.emit('set-user',user); updateUI(); showScreen('main-screen'); checkDaily();
      } catch(e) { btn.classList.remove('btn-loading'); btn.disabled = false; toast('Connection error'); }
    }

    
    // Sound Effects System
    // Profile Functions
    async function loadProfile() {
      if (!user) return;
      document.getElementById('profile-avatar').textContent = user.equippedAvatar;
      document.getElementById('profile-avatar').style.background = user.equippedColor;
      document.getElementById('profile-username').textContent = user.username;
      document.getElementById('profile-level').textContent = user.level;
      document.getElementById('profile-xp').textContent = user.xp;
      document.getElementById('profile-games').textContent = user.total_games || 0;
      document.getElementById('profile-wins').textContent = user.total_wins || 0;
      document.getElementById('profile-streak').textContent = user.best_streak || 0;
      document.getElementById('profile-accuracy').textContent = (user.accuracy || 0) + '%';
      try {
        const r = await fetch('/api/history/' + user.id);
        const history = await r.json();
        document.getElementById('profile-history').innerHTML = history.length ? history.map(g => `'<div style="display:flex;justify-content:space-between;padding:10px;background:rgba(255,255,255,0.05);border-radius:8px;margin-bottom:8px"><div><span style="font-weight:600">${g.game_mode || 'Classic'}'</span><span style="color:rgba(255,255,255,0.5);margin-left:8px">${g.theme || 'Random'}'</span></div><div style="text-align:right"><div style="font-weight:700;color:#00d4ff">#${g.rank} ‚Ä¢ ${g.score}pts</div><div style="font-size:0.75rem;color:rgba(255,255,255,0.5)">${g.correct_answers}/${g.total_questions} correct</div></div></div>'`join('') : '<p style="text-align:center;color:rgba(255,255,255,0.5)">No games played yet</p>';
      } catch(e) {
        document.getElementById('profile-history').innerHTML = '<p style="text-align:center;color:rgba(255,255,255,0.5)">Unable to load history</p>';
      }
    }


    // Create floating particles
    (function createParticles() {
      const container = document.getElementById('particles');
      const colors = ['rgba(0,212,255,0.5)', 'rgba(124,58,237,0.5)', 'rgba(244,114,182,0.5)', 'rgba(251,191,36,0.5)'];
      for (let i = 0; i < 30; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random() * 100 + '%';
        p.style.animationDelay = Math.random() * 15 + 's';
        p.style.animationDuration = (15 + Math.random() * 10) + 's';
        p.style.background = colors[Math.floor(Math.random() * colors.length)];
        p.style.width = (2 + Math.random() * 4) + 'px';
        p.style.height = p.style.width;
        container.appendChild(p);
      }
    })();

    function calcPoints() {
      const base = +document.getElementById('test-base').value;
      const timeLeft = +document.getElementById('test-time').value;
      const streak = +document.getElementById('test-streak').value;
      const diffMult = +document.getElementById('test-diff').value;
      const timeLimit = 10;
      
      const speedBonus = timeLeft * 10;
      const streakBonus = Math.min(streak * 10, 50);
      const total = Math.floor((base + speedBonus) * diffMult) + streakBonus;
      
      const el = document.getElementById('points-result');
      el.style.display = 'block';
      el.innerHTML = `<strong>Points Breakdown:</strong><br>
        Base: ${base}<br>
        Speed Bonus: +${speedBonus} (${timeLeft}s left √ó 10)<br>
        Streak Bonus: +${streakBonus} (${streak} streak √ó 10, max 50)<br>
        Difficulty: ${diffMult}x<br>
        <hr style="border-color:rgba(255,255,255,0.2);margin:8px 0">
        <strong style="font-size:1.3rem;color:#22c55e">Total: ${total} pts</strong>`;
    }

    function calcXP() {
      const currentXp = +document.getElementById('test-xp').value;
      const addXp = +document.getElementById('test-xp-add').value;
      
      const calcLevel = (xp) => Math.floor(Math.sqrt(xp / 100)) + 1;
      const xpForLevel = (lvl) => Math.pow(lvl - 1, 2) * 100;
      
      const oldLevel = calcLevel(currentXp);
      const newLevel = calcLevel(currentXp + addXp);
      const leveledUp = newLevel > oldLevel;
      
      const currentLevelXp = xpForLevel(oldLevel);
      const nextLevelXp = xpForLevel(oldLevel + 1);
      const progress = ((currentXp + addXp) - currentLevelXp) / (nextLevelXp - currentLevelXp) * 100;
      
      const el = document.getElementById('xp-result');
      el.style.display = 'block';
      el.innerHTML = `<strong>XP & Level:</strong><br>
        Current Level: ${oldLevel}<br>
        XP: ${currentXp} ‚Üí ${currentXp + addXp}<br>
        ${leveledUp ? `<span style="color:#fbbf24">üéâ Level Up! Now Level ${newLevel}</span><br>` : ''}
        Progress to Level ${oldLevel + 1}: ${Math.min(100, progress).toFixed(1)}%<br>
        XP needed for next level: ${nextLevelXp - (currentXp + addXp)}<br>
        <hr style="border-color:rgba(255,255,255,0.2);margin:8px 0">
        <div style="background:rgba(255,255,255,0.1);height:10px;border-radius:5px;overflow:hidden">
          <div style="background:linear-gradient(90deg,#00d4ff,#7c3aed);height:100%;width:${Math.min(100, progress)}%"></div>
        </div>`;
    }

    function simGame() {
      const score = +document.getElementById('sim-score').value;
      const rank = +document.getElementById('sim-rank').value;
      
      const xpGained = Math.floor((score / 10) + (rank === 0 ? 100 : rank === 1 ? 50 : rank === 2 ? 25 : 10));
      const coinsGained = Math.floor(score / 20) + (rank === 0 ? 20 : 10);
      
      const el = document.getElementById('sim-result');
      el.style.display = 'block';
      el.innerHTML = `<strong>Game End Rewards:</strong><br>
        Score: ${score}<br>
        Rank: ${['ü•á 1st','ü•à 2nd','ü•â 3rd','4th+'][rank]}<br>
        <hr style="border-color:rgba(255,255,255,0.2);margin:8px 0">
        <span style="color:#00d4ff;font-size:1.3rem">+${xpGained} XP</span><br>
        <span style="color:#fbbf24;font-size:1.3rem">+${coinsGained} ü™ô</span><br>
        <small style="color:rgba(255,255,255,0.5)">XP = score/10 + rank bonus<br>Coins = score/20 + rank bonus</small>`;
    }

    function initSandbox() {
      const powers = [
        {id:'fifty_fifty',name:'50/50',desc:'Remove 2 wrong answers',icon:'‚úÇÔ∏è'},
        {id:'time_freeze',name:'Time Freeze',desc:'+5 seconds',icon:'‚è±Ô∏è'},
        {id:'double_points',name:'Double Points',desc:'2x points this round',icon:'‚ú®'},
        {id:'shield',name:'Shield',desc:'Protected from one wrong',icon:'üõ°Ô∏è'},
        {id:'peek',name:'Peek',desc:'See most popular answer',icon:'üëÅÔ∏è'},
        {id:'second_chance',name:'Second Chance',desc:'Answer again if wrong',icon:'üîÑ'},
        {id:'steal',name:'Steal',desc:'Steal 50 pts from player',icon:'üí∞'},
        {id:'freeze_player',name:'Freeze',desc:'Freeze player for 5s',icon:'‚ùÑÔ∏è'},
        {id:'imposter',name:'Imposter',desc:'Swap scores with player',icon:'üé≠'},
        {id:'oracle',name:'Oracle',desc:'Hint at correct answer',icon:'üîÆ'},
        {id:'bomb',name:'Bomb',desc:'Others lose 30 pts',icon:'üí£'},
        {id:'gamble',name:'Gamble',desc:'Random -50 to +200 pts',icon:'üé≤'},
        {id:'ban',name:'Ban',desc:'Ban one answer for all',icon:'üìõ'}
      ];
      
      document.getElementById('powers-ref').innerHTML = powers.map(p => 
        `<div style="background:rgba(255,255,255,0.05);padding:8px;border-radius:8px">
          <span style="font-size:1.2rem">${p.icon}</span> <strong>${p.name}</strong><br>
          <small style="color:rgba(255,255,255,0.6)">${p.desc}</small>
        </div>`
      ).join('');
      
      const avatars = [
        {emoji:'ü¶äüê∏üê±üê∂üê∞üêª',level:1,rarity:'common'},
        {emoji:'ü¶Åüêº',level:5,rarity:'rare'},
        {emoji:'ü¶Ñü¶ã',level:10,rarity:'rare'},
        {emoji:'ü¶Öüê∫ü¶àüê¨',level:15,rarity:'epic'},
        {emoji:'ü¶âüê≤ü¶ö',level:20,rarity:'legendary'},
        {emoji:'üëëüåüüî•',level:50,rarity:'mythic'}
      ];
      
      const colors = [
        {name:'Ocean Blue, Purple Haze, Pink Dream, Forest Green, Golden Sun, Fire Red',level:1,rarity:'common'},
        {name:'Cyan Wave, Violet Storm',level:5,rarity:'rare'},
        {name:'Hot Pink, Teal Ocean',level:10,rarity:'rare'},
        {name:'Rainbow, Galaxy',level:20,rarity:'epic'},
        {name:'Sunset',level:30,rarity:'legendary'},
        {name:'Neon',level:35,rarity:'legendary'},
        {name:'Aurora',level:50,rarity:'mythic'}
      ];
      
      document.getElementById('unlocks-ref').innerHTML = `
        <p style="margin-bottom:10px"><strong>Avatars unlock at levels:</strong></p>
        ${avatars.map(a => `<div style="margin-bottom:5px"><span style="background:${a.rarity==='mythic'?'linear-gradient(90deg,#ff00ff,#00ffff)':a.rarity==='legendary'?'linear-gradient(90deg,#fbbf24,#f59e0b)':a.rarity==='epic'?'linear-gradient(90deg,#8b5cf6,#7c3aed)':a.rarity==='rare'?'linear-gradient(90deg,#3b82f6,#2563eb)':'rgba(255,255,255,0.2)'};padding:2px 6px;border-radius:4px;font-size:0.8rem">${a.rarity}</span> Lv.${a.level}: ${a.emoji}</div>`).join('')}
        <p style="margin:15px 0 10px"><strong>Colors unlock at levels:</strong></p>
        ${colors.map(c => `<div style="margin-bottom:5px"><span style="background:${c.rarity==='mythic'?'linear-gradient(90deg,#ff00ff,#00ffff)':c.rarity==='legendary'?'linear-gradient(90deg,#fbbf24,#f59e0b)':c.rarity==='epic'?'linear-gradient(90deg,#8b5cf6,#7c3aed)':c.rarity==='rare'?'linear-gradient(90deg,#3b82f6,#2563eb)':'rgba(255,255,255,0.2)'};padding:2px 6px;border-radius:4px;font-size:0.8rem">${c.rarity}</span> Lv.${c.level}: ${c.name}</div>`).join('')}
      `;
    }

    function resetSandbox() {
      if(confirm('This will reset all test inputs. Continue?')) {
        document.getElementById('test-base').value = 100;
        document.getElementById('test-time').value = 5;
        document.getElementById('test-streak').value = 3;
        document.getElementById('test-diff').value = 1.5;
        document.getElementById('test-xp').value = 0;
        document.getElementById('test-xp-add').value = 150;
        document.getElementById('sim-score').value = 500;
        document.getElementById('sim-rank').value = 0;
        document.getElementById('points-result').style.display = 'none';
        document.getElementById('xp-result').style.display = 'none';
        document.getElementById('sim-result').style.display = 'none';
      }
    }

    initSandbox();
  </script>
</body>
</html>